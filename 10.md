# NIP-10: クライアントによるテキストイベントでの "e" および "p" タグ使用に関する規則

> 訳注：以下の訳は Nov 8, 2022 のコミットに基づくが、
プロトコル定義に影響する改訂が Dec 29, 2022 に加えられているので注意。

`draft` `optional` `author:unclebobmartin`

## 概要

この NIP では、テキストイベント内で、とりわけ他のテキストイベントへの返信において "e" および "p" タグを使う方法を記す。
これによりクライアントが、元のイベントをルートとして返信をツリー状にスレッド化する手助けとなる。

## 位置による "e" タグ (非推奨：DEPRECATED)

> このスキームは広く使用されているが、非推奨と見なされるべきである。

`["e", <event-id>, <relay-url>]` NIP-01 による。

ただし、

* `<event-id>` は、参照されているイベントの ID である。

* `<relay-url>` は、参照に関連付けられた推奨リレーの URL である。多くのクライアントは、このフィールドをオプションとして扱う。
 
**イベント内の "e" タグの位置が、以下の特定の含意を有する。**

* "e" タグなし：
当該イベントは他のイベントへのリプライではなく、参照もしていない。

* 1 つの "e" タグ：
`["e", <id>]`：このイベントがリプライする対象のイベント ID。

* 2 つの "e" タグ：
`["e", <root-id>]`, `["e", <reply-id>]`：
リプライ・チェーンのルートとなるイベントの ID が`<root-id>` である。当該イベントがリプライする対象記事の ID が `<reply-id>` である。

* 多数の "e" タグ：`["e", <root-id>]` `["e", <mention-id>]`, ..., `["e", <reply-id>] `：
`<mention-id>` は幾つあってもよい。これらはリプライ・チェーンに含まれうる、あるいは含まれないかもしれないイベントの ID を指す。
これらのイベントは、当該イベントを引用する関係にある。`root-id` と `reply-id` は上記のとおりである。

> このスキームは、イベントが別のイベントを参照しているが応答はしていない場合、
解決が困難または不可能なあいまいさを生み出すため、非推奨となっている。

## マークされた "e" タグ（推奨）
`["e", <event-id>, <relay-url>, <marker>]`

ただし、

* `<event-id>` は、参照されているイベントの ID である。

* `<relay-url>` は、参照に関連付けられた推奨リレーの URL であり、今度は必須である。

* `<marker>` はオプションで、存在する場合は `"reply"` または `"root"` のいずれかの値を取る。

**"e" タグの順序は関係ない。** `"reply"` でマークされたものは、`<reply-id>` を表す。
`"root"` でマークされたものは、リプライ・スレッドのルート ID を示す。

> この仕組みであれば `<reply-id>` や `<root-id>` と混同することなく、イベントが他者にメンションを飛ばせるため、推奨される。

## "p" タグ

テキストイベントで使用され、公開鍵のリストが含まれる。
リプライ・スレッドに誰が関与しているかを、記録する目的で使われる。

テキストイベント E を対象にリプライする場合、リプライの中の "p" タグには、
E（返信対象）の全ての "p" タグに加え、`"pubkey"` が含まれている必要がある。

例：ユーザー `a1` によって執筆された、 "p" タグの中身に [`p1`、`p2`、`p3`] を持つテキストイベントがあったとする。
これに返信するイベントの "p" タグには [`a1`、`p1`、` p2`、`p3`] が含まれなければならない。順序は考慮されない。
