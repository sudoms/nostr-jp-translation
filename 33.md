# NIP-33: パラメータ化された置き換え可能イベント

`draft` `optional` `author:Semisol` `author:Kukks` `author:Cameri` `author:Giszmo`

この NIP では、kind のみが維持される NIP-16 のものとは異なり、
元の `d` タグと kind を保ちつつイベントを置き換えることが可能な、新しいイベント範囲が追加される。

## 実装

*パラメーター化された置き換え可能イベント* は、kind `30000 <= n <40000` のイベントとして定義される。
パラメーター化された置き換え可能イベントが受信され、
kind および最初の `d` タグの値が等しい既存イベントのどれよりも、そのタイムスタンプが新しいものであったならば、
古いイベントは破棄され、新しいイベントに置き換えられるべきである。

`d` タグが欠落しているか値を欠いている場合、空文字列を値として持つ `d` タグとして解釈されるべきである。
また作者が同じであり、以下の `tags` のいずれかを持つイベント同士は、相互に置換可能なものとする。

* `"tags":[["d",""]]`
* `"tags":[]`: 空の値を持つ `d` タグが暗黙に存在しているとみなされる
* `"tags":[["d"]]`: （`d` タグが存在しており）暗黙に空の値 `""` を持つ
* `"tags":[["d",""],["d","not empty"]]`: 最初の `d` タグだけが考慮される
* `"tags":[["d"],["d","some value"]]`: 最初の `d` タグだけが考慮される
* `"tags":[["e"]]`: タグがない場合と同じ

> 訳注： `"tags":[]` や `"tags":[["e"]]` は `30000 <= n <40000` のいずれかの kind を持っているため、
`d` タグがなくとも置き換え可能イベントであることは承知の上である。

## クライアントの振る舞い

クライアントは、リレーにおける本 NIP のサポート状況を知るために、
`supported_nips` フィールドを用いるとよい。
この NIP をサポートしていないかもしれないリレーに、パラメーター化された置き換え可能イベントを送信する可能性を鑑み、
リレーが（古いものから新しいものまで）複数のイベントを送ってきた場合に備えて、
クライアント側にも最新の 1 つを選ぶためのクエリを設けておくべきである。
またクライアントにおいて、`#d` タグフィルタを付して送信することが推奨される。
そして `d` タグが欠落している、もしくはタグに値が入っていない場合はタグフィルターの返り値が存在しない、
という事実を考慮し、クライアントは値のある `d` タグを常に含めるべきである。

