# NIP-16: イベント処理

`draft` `optional` `author:Semisol`

リレーは（レギュラーイベントに加えて）、「置き換え可能イベント」や「一時的イベント」のいずれかもしくは双方をサポートできる。

## レギュラーイベント

*Regular event* は、kind `1000 <= n < 10000` のイベントとして定義される。
レギュラーイベントを受信したリレーは、フィルターにマッチする全てのクライアントへこれを送信すると共に、保持し続ける必要がある。
同じ kind の新しいイベントは、以前のイベントには全く影響しない。

## 置き換え可能（replaceable）イベント

*Replaceable event* は、kind `10000 <= n < 20000` のイベントとして定義される。
同じ kind の最新のイベントよりも新しいタイムスタンプを持ち、かつ同一の鍵で署名された置き換え可能イベントを受信した場合には、
（リレーは）古いイベントを破棄して新しいイベントに置き換える必要がある。

## 一時的（ephemeral）イベント

*Ephemeral event* は、kind `20000 <= n < 30000` のイベントとして定義される。
レギュラーイベントを受信したリレーは、フィルターにマッチする全てのクライアントへこれを送信すべきであり、
かつイベントをリレー内に保持し続けてはいけない。

## クライアントの振る舞い

クライアントは `supported_nips` フィールドを使用して、リレーがこの NIP をサポートしているかどうかを確認すべきである。
この NIP をサポートしないリレーへは、一時的イベントを送信すべきではない。さもないとイベントが永続的に保持されてしまう。

この NIP をサポートしていない可能性のあるリレーへも、置き換え可能イベントを送信することは可能である。
この場合、クライアント側のクエリは、リレーが複数のイベントを送ってくる事態を想定して、最新のイベントを選べるように実装すべきである。

## 推奨される使用例

* 状態：アプリケーションは、新しい状態 （ステータスなど）が設定されるたびに置換される、状態イベントを作成できる。

* タイピング・インジケータ：チャットアプリケーションは、ユーザーがキーをタイピング中である状態を、
一時的なイベントとして使用できる。

* メッセージング：一時的なイベントを使用して、nostr 経由で 2 つの公開鍵（訳注：ユーザー）間のメッセージを送信できる。

