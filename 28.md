# NIP-28: 公開チャット

`draft` `optional` `author:ChristopherDavid` `author:fiatjaf` `author:jb55` `author:Cameri`

この NIP は、公開チャットのチャネル、チャネルメッセージ、
そして基本的なクライアントサイドのトラブル調停のためのイベントの種類を定義する。

5 つのイベント（40-44）が即時に使用され、将来の使用のために 5 つのイベント（45-49）が予約される。

- `40 - チャンネル作成`
- `41 - チャンネルのメタデータ`
- `42 - チャンネルメッセージ`
- `43 - メッセージを隠す`
- `44 - ユーザーをミュートする`

調停をクライアント中心志向で行うことにより、クライアント開発者はリレーに追加の要件を課すことなく、
アプリケーションで扱いたいコンテンツの種類を自らの裁量で決められる。

## Kind 40: チャンネルを新規作成する

公開チャットチャネルを作成する。

チャンネル作成時の `content` フィールドには、クライアントにおいてチャンネルの基本的なメタデータをセットすべきである（kind 41 で定める `name`, `about`, `picture` のこと）。

```json
{
    "content": "{\"name\": \"Demo Channel\", \"about\": \"A test channel.\", \"picture\": \"https://placekitten.com/200/200\"}",
    ...
}
```

## Kind 41: チャンネルのメタデータをセットする

チャンネルの公開メタデータを更新する。

この際クライアントおよびリレーは、kind 0 こと `metadata` イベントに類似の、kind 41 のイベントを扱えるようにすべきである。

またクライアントは、kind 40 にある公開鍵を除き、他の公開鍵から来た kind 41 を無視すべきである。

さらにクライアントは、以下の基本的なメタデータフィールドをサポートすべきである。

- `name` - string - チャンネル名
- `about` - string - チャンネルの説明
- `picture` - string - チャンネル画像の URL

これ以外のメタデータフィールドを、クライアントにおいて追加しても良い。

クライアントは `NIP-10` にある `"e"` タグを用いて、推奨リレーを示すべきである。

```json
{
    "content": "{\"name\": \"Updated Demo Channel\", \"about\": \"Updating a test channel.\", \"picture\": \"https://placekitten.com/201/201\"}",
    "tags": [["e", <channel_create_event_id> <relay-url>]],
    ...
}
```

## Kind 42: チャンネルメッセージの新規作成

チャンネルにテキストメッセージを送信する。

この際クライアントは `NIP-10` の `"e"` タグを用いて、推奨リレーを示すとともに、
現メッセージがルートメッセージなのか、返信なのかを明示すべきである。

返信であるならば、同じく `NIP-10` で定義されている `"p"` タグも付加すべきである。

ルートメッセージの例：

```json
{
    "content": <string>,
    "tags": [["e", <kind_40_event_id> <relay-url> "root"]],
    ...
}
```

別のメッセージへの返信：

```json
{
    "content": <string>,
    "tags": [
        ["e", <kind_42_event_id> <relay-url> "reply"],
        ["p", <pubkey> <relay-url>],
        ...
    ],
    ...
}
```


## Kind 43: メッセージを隠す

チャットにおいて、ユーザーが特定のメッセージを表示したくない場合もあるだろう。

（訳注：kind 43 は以下のような構造のイベントであり、非表示にすべきメッセージのイベント ID を指定する）

```json
{
    "content": "{\"reason\": \"イチモツの写真\"}",
    "tags": [["e", <kind_42_event_id>]],
    ...
}
```

Kind 43 イベントの `content` 欄には、`reason` のようなメタデータをオプションで含めることもできる。

クライアントは、自ユーザーが kind 43 のイベントを作成・送信しており、
その中でイベントの `id`（kind 42 で定義されるチャットメッセージの ID）が言及されている場合、
この `id` が指し示すメッセージを表示すべきではない。

さらにクライアントは、 kind 43 イベントを作成・送信した自ユーザー以外のクライアント画面上でも、
上記に当てはまるチャットメッセージ（kind 42 イベント）を非表示にできる。

> 例：あるイベントに対して 3 名のユーザーが、「ポルノ」という単語を `reason` に記す形で、これを非表示にしたとする。
Nostr クライアントが iOS アプリであったとして、iOS 上で動作する Nostr クライアント全ての画面上で、
このメッセージを非表示にするような扱いも可能である。

## Kind 44: ユーザーをミュートする

メッセージのみならず、特定ユーザーからのチャットメッセージをもはや見たくない場合もあるだろう。

（訳注：kind 44 は以下のような構造のイベントであり、ミュートしたい対象ユーザーの公開鍵を指定する）

```json
{
    "content": "{\"reason\": \"イチモツの写真を投稿している\"}",
    "tags": [["p", <pubkey>]],
    ...
}
```

Kind 44 イベントの `content` 欄には、kind 43 と同じく、`reason` のようなメタデータをオプションで含めることもできる。

クライアントは、自ユーザーが kind 44 のイベントを作成・送信しており、
その中で `pubkey`（ミュート対象であるユーザーの公開鍵）が言及されている場合、
この `pubkey` が指し示すユーザーから送られてきた kind 42 形式のチャットメッセージを表示すべきではない。

さらにクライアントは、 kind 44 イベントを作成・送信した自ユーザー以外のクライアント画面上でも、
当てはまるユーザーから送られてきたチャットメッセージ（kind 42 イベント）を非表示にできる。


## NIP-10 にある推奨リレー

`NIP-10` で定義されているところの推奨リレーに関して、クライアントは通常、
オリジナルの（時間的に最古である）kind 40 のイベントに書かれているリレー URL を使用すべきである。

（とはいえ）クライアントは、任意のリレー URL を推奨することができる。
たとえば、チャンネルのオリジナルの kind 40 イベントをホストしているリレーがオフラインであれば、
クライアントはバックアップのリレーからチャンネルデータを取得してもよいだろう。
あるいはオリジナルのリレーよりも信頼に足ると判断すれば、クライアントは他のリレーから情報を取得してもいい。


## 将来の拡張性

チャットに関連する他のイベント用に、kind 45-49 が予約されている。潜在的な用途として、新しいタイプのメディア（写真・ビデオ）、
トラブル調停、そしてプライベート・メッセージやグループ・メッセージといった機能のサポートが挙げられる。

## 動機

ソーシャルメディア構築の目的において、検閲に耐えるコミュニケーション手段として Nostr の仕組みを用いることが可能であれば、
同様に Telegram スタイルのメッセージサービスにおいても、検閲対策として用いることができる。

これにより、壁に囲まれた庭園ではなく真の公共空間での意見交換に、世界中の人々がアクセス可能となるだろう。

## 追加情報

- [チャットのデモ PR（fiatjaf+jb55 のコメントあり）](https://github.com/ArcadeCity/arcade/pull/28)

- [NIP16 に関するやりとり](https://t.me/nostr_protocol/29566)
