# NIP-02: コンタクトリストと愛称（petnames）

`final` `optional` `author:fiatjaf` `author:arcbtc`

「連絡先リスト」を意味する kind `3` を持つ特別なイベントが、
`p` （プロファイル）タグを束ねたリストを持つものとして定義される。
各々の `p` タグは、フォロー中のユーザーのプロファイルである。

各タグエントリにはプロファイルの公開鍵、その鍵で発信されたイベントを見つけられるリレーの URL
（不要な場合は空の文字列でもいい）、およびそのプロファイルのローカル名（または「愛称」）を含めるべきである
（これも空文字列であってもいい）。
すなわち `["p"、<32-bytes hex key>、<main relay url>、<petname>]` のような形式になる。
続く `content` の中身は任意のテキストが入りうるので、無視する必要がある。

コンタクトリストの例

```json
{
  "kind": 3,
  "tags": [
    ["p", "91cf9..4e5ca", "wss://alicerelay.com/", "alice"],
    ["p", "14aeb..8dad4", "wss://bobrelay.com/nostr", "bob"],
    ["p", "612ae..e610f", "ws://carolrelay.com/ws", "carol"]
  ],
  "content": "",
  ...その他のフィールド
}
```

新しいコンタクトリストが公開されたとき、古いものがあれば常にそれを上書きするので、
全てのエントリを含めるべきである。
リレーやクライアントは、新しいコンタクトリストを受信した場合、遅滞なく古いリストをデリートすべきである。

## 用途

### 連絡先リストのバックアップ

リレーがイベントを十分な期間保存することが見込める場合には、この kind-3 のイベントを利用して誰をフォローするかのリストをバックアップし、別のデバイスで回復できる。

### プロフィール探しとコンテキストの増強

クライアントは kind-3 イベントによって、
閲覧中のプロファイルがフォローしている人々のリストを表示することもできる。
つまり自分がフォロー、ないしは閲覧中のユーザーが持っているコンタクトリストを入手し、これをベースに、
新たにフォローすると良さげなユーザーをリスト化できるだろう。あるいは他の状況でデータを表示する。

### リレーの共有

クライアントは、各連絡先に到達するための良質なリレーを記した、連絡先のフルリストを公開することができる。
これを用いれば他のクライアントは必要に応じて内部リレーリストを更新でき、高い検閲耐性に寄与する。

### 愛称（petname）スキーム

こうした連絡先リストのデータを用いて、クライアントがローカルに ["愛称"](http://www.skyhunter.com/marcs/petnames/intropetnames.html) の一覧表を作成・保持することもできる。
（ユーザー ID の代わりに）グローバル（注）かつ人間が読み取り可能な名前が切望されており、愛称一覧はこの点の解決に寄与する。

たとえばユーザーがクライアント内に保有する連絡先リストに、以下の項目があったとしよう。

```json
[
  ["p", "21df6d143fb96c2ec9d63726bf9edc71", "", "erin"]
]
```

さらに 2 つのコンタクトリストを受け取ったとする。
一方は `21df6d143fb96c2ec9d63726bf9edc71` というユーザー ID からのもので、

```json
[
  ["p", "a8bb3d884d5d90b413d9891fe4c4e46d", "", "david"]
]
```

と書かれている。もう一方は `a8bb3d884d5d90b413d9891fe4c4e46d` というユーザー ID からで、

```json
[
  ["p", "f57f54057d2a7af0efecc8b0b66f5708", "", "frank"]
]
```

とある。

この状態で `21df6d143fb96c2ec9d63726bf9edc71` の項目を閲覧すると、
クライアントは長ったらしいフル ID の代わりに _erin_ と表示する。
あるいは `a8bb3d884d5d90b413d9891fe4c4e46d` の代わりに _david.erin_ と表示する。
また  `f57f54057d2a7af0efecc8b0b66f5708` の代わりに _frank.david.erin_ と表示する。

> 訳注：ここでいう「グローバル」は、「世の中の誰もが、その名前を耳にした時に特定の存在を想起できる」
という意味らしい。ここから、「人間が簡単に覚えられる程度に短く、しかも他の名前と重複しないという条件を課すと、そんなに都合よくグローバル性を満たす名前なんぞ付けられない」という議論に発展する。詳しくは[上のリンク先](http://www.skyhunter.com/marcs/petnames/intropetnames.html)の資料を読んでほしい。

> 訳注：上の例には「俺→ _erin_ 」「_erin_ → _david_」「_david_ → _frank_」という 3 通りの
フォローフォロワー関係のエッジが存在する。
なので、_frank_ という人間の一意な愛称として「（俺がフォローしている）エリンがフォローしているデイビッドがフォローしているフランク」という名付け方が可能なわけだ。
> まあ今回は、たまたま「俺→ _erin_ → _david_ → _frank_」という一直線の関係が成り立つゆえに、
愛称も矛盾・重複はない。しかし現実には一直線とも限らない。どうしたもんかね。

----
