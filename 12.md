# NIP-12: 汎用タグ・クエリ

`draft` `optional` `author:scsibug` `author:fiatjaf`

リレーは、任意のタグでサブスクリプションをサポートすることがある。
`NIP-01` では、リレーが `e` および `p` タグのクエリに応答することを求めている。
この NIP により、イベントに存在する任意の 1 文字のタグでクエリを掛けられる。

`NIP-01` で説明されている `<filters>` オブジェクトは、`#` 接頭辞を持つ任意のキーを含むように展開される。
`#` で始まるフィルター内の任意の 1 文字のキーはタグ・クエリであり、その値は 1 つの文字列配列でなければならない。
イベントが同じ名称のタグを持ち、その中の少なくとも 1 つの値がフィルターとイベント間で共通する場合に、フィルター条件が真となる。
（クエリに放り込むときの）タグ名は `#` を除いた文字部分であり、2 番めの要素が（フィルター対象の）値として扱われる。
後続の要素は、タグ・クエリでは無視される。

## サブスクリプション・フィルタの例

以下は種類 `1` のイベントにマッチし、`r` タグの値が `foo` もしくは `bar` に一致するフィルタの例である。

```JSON
{
  "kinds": [1],
  "#r": ["foo", "bar"]
}
```

## クライアントの振る舞い

クライアントは、リレーが汎用タグ・クエリをサポートしているかどうかを、`supported_nips` フィールドを用いて確認すべきである。
この NIP がサポートされていないリレーからの、無関係な応答を除外する用意ができているクライアントは、
汎用タグクエリを任意のリレーに送信してもよい。

## 本仕様の理由

1 文字のタグだけをクエリ用に予約する決定により、アプリケーションはリレーのインデックスを肥大化させる恐れなく、
その本来の目的に従い、あらゆる種類のメタデータを対象としてタグを使用できるようになる。
もちろん、これはリレーの軽量化にも寄与する。
また一部のアプリケーションまたはユーザーが、リレーを肥大化させる目的で 1 文字タグを悪用している場合でも、
実際に有効なメタデータとしてアプリケーションが付加するタグとの混同の恐れが少ないため、検出が容易になる。

## ありえる使用例

汎用タグ・クエリが便利に使える例を、以下に示す。
ただしこの NIP は、特定のタグが特定の目的に使われることを、促進または標準化するものではない。

* 分散型コメントシステム：クライアントは、`r`（"reference"、この場合は URL）タグと値を使用して、
任意の Web ページにコメントしたり、他のコメントを簡単に検索したりできる。

* ロケーション固有の投稿：クライアントは `g`（"geohash"）タグを使用して、物理的な地点に関連付いた投稿が可能である。
クライアントは、さまざまな精度の一連のジオハッシュを自らの近傍で検索して、ローカルコンテンツを見つけられる。

* ハッシュタグ：クライアントは単純な `t`（"hashtag"）タグを使用して、
簡単に検索できるトピック名にイベントを関連付けることができます。
Nostr イベント自体を検索する手段はプロトコル上にはないが、この方法でユーザー主導の検索メカニズムが提供される。
